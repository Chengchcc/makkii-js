# `@makkii/app-aion`

Aion application client.
This library uses some third-party service:

-   Web3 JsonRPC - you can pass in jsonrpc in [AionApiClient](#aionapiclient) Constructor
-   Explorer Api - we use <https://mainnet-api.theoan.com> to get transaction history, token history. 
-   Transaction Explorer - we use [https://mainnet.theoan.com/#/transaction/`txHash`](https://mainnet.theoan.com/#/transaction/`txHash`) to show transaction detail page.
-   Remote Api - we setup our own server to provide token list and icons.

## Installation

```bash
npm install @makkii/app-aion
```

## Usage

```typescript
import { AionApiClient, AionKeystoreClient, AionLocalSigner } from '@makkii/app-aion';

const api_client = new AionApiClient({
    network: 'mainnet',
    jsonrpc: '***'
});
api_client.getBalance('0x...')
    .then(console.log)
    .catch(error=>console.log(error));
const keystore_client = new AionKeystoreClient();
api_client.buildTransaction(
    '0x...', // from address
    '0x...', // to address
    0, // amount
    {
        gasPrice: 10,
        gasLimit: 21000,
        isTokenTransfer: false
    }
).then(function(unsignedTx) {
    keystore_client.signTransaction(unsignedTx, new AionLocalSigner(), {
        private_key: '***'
    }).then(function(signedTx) {
        console.log(signedTx);
    });
});
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [IAionConfig](#iaionconfig)
    -   [network](#network)
    -   [jsonrpc](#jsonrpc)
    -   [explorer_api](#explorer_api)
    -   [explorer](#explorer)
    -   [remote_api](#remote_api)
-   [AionKeystoreClient](#aionkeystoreclient)
    -   [getAccountFromMnemonic](#getaccountfrommnemonic)
        -   [Parameters](#parameters)
    -   [recoverKeyPairByPrivateKey](#recoverkeypairbyprivatekey)
        -   [Parameters](#parameters-1)
    -   [recoverKeyPairByKeyFile](#recoverkeypairbykeyfile)
        -   [Parameters](#parameters-2)
    -   [validatePrivateKey](#validateprivatekey)
        -   [Parameters](#parameters-3)
    -   [validateAddress](#validateaddress)
        -   [Parameters](#parameters-4)
-   [AionLocalSigner](#aionlocalsigner)
    -   [signTransaction](#signtransaction)
        -   [Parameters](#parameters-5)
-   [AionUnsignedTx](#aionunsignedtx)
-   [AionApiClient](#aionapiclient)
    -   [Parameters](#parameters-6)
    -   [getNetwork](#getnetwork)
    -   [getBlockByNumber](#getblockbynumber)
        -   [Parameters](#parameters-7)
    -   [getBlockNumber](#getblocknumber)
    -   [getTransactionStatus](#gettransactionstatus)
        -   [Parameters](#parameters-8)
    -   [getTransactionsByAddress](#gettransactionsbyaddress)
        -   [Parameters](#parameters-9)
    -   [sendTransaction](#sendtransaction)
        -   [Parameters](#parameters-10)
    -   [getTokenIconUrl](#gettokeniconurl)
        -   [Parameters](#parameters-11)
    -   [buildTransaction](#buildtransaction)
        -   [Parameters](#parameters-12)
-   [AionPendingTx](#aionpendingtx)

### IAionConfig

Aion configuration interface

#### network

Network name

Type: (`"mainnet"` \| `"amity"`)

#### jsonrpc

Json RPC endpoint

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### explorer_api

api endpoint that used to query transaction information

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### explorer

transaction page base url

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### remote_api

app server endpoint that provides token, icons, etc.

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

### AionKeystoreClient

Aion keystore client that implements IsingleKeystoreClient interface

#### getAccountFromMnemonic

Get account from mnemonic

##### Parameters

-   `address_index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** index in hd wallet
-   `mnemonic` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** mnemonic phrase

Returns **any** account object: { private_key: '', public_key: '', address: '', index: '' }

#### recoverKeyPairByPrivateKey

Recover key pair by private key

##### Parameters

-   `priKey` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `privKey`  private key

Returns **any** key pair object: { private_key: '', public_key: '', address: '' }

#### recoverKeyPairByKeyFile

Recover key pair by key file

##### Parameters

-   `file` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** file content
-   `password` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** protection password

Returns **any** key pair object: { private_key: '', public_key: '', address: '' }

#### validatePrivateKey

Check if private key is valid

##### Parameters

-   `privateKey` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** string or Buffer

Returns **any** if private key is valid

#### validateAddress

Check if address is valid

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** address to be validated

### AionLocalSigner

Aion's signer using private key, implements IkeystoreSigner.

#### signTransaction

Sign transaction

##### Parameters

-   `tx` **[AionUnsignedTx](#aionunsignedtx)** AionUnsginedTx transaction object to sign.
-   `params` **{private_key: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** parameters object, example: { private_key: '' }}

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** transaction hash string

### AionUnsignedTx

Aion unsigned transaction interface

-   to: string;
-   from: string;
-   nonce: string;
-   value: BigNumber;
-   gasPrice: number;
-   gasLimit: number;
-   timestamp: number;
-   data?: any;
-   type?: number;
-   tknTo?: string;
-   tknValue?: BigNumber;

### AionApiClient

Aion api client that implement IsingleApiFullClient

#### Parameters

-   `config` **[IAionConfig](#iaionconfig)** 

#### getNetwork

Get network name: mainnet, amity and mastery.

#### getBlockByNumber

Get block by number, block information doesn't contains transaction details

##### Parameters

-   `blockNumber` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** block number's hex string

Returns **any** eth_getBlockNumber response's result

#### getBlockNumber

Get latest block number

Returns **any** eth_getBlockNumber response's result

#### getTransactionStatus

Get transaction status.

##### Parameters

-   `hash` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** transaction hash

Returns **any** if eth_getTransactionReceipt is null, returns null;
         else return object { status: true/false, blockNumber: intger, gasUsed: integer }

#### getTransactionsByAddress

Get transactions by the given address

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** account address
-   `page` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** page number
-   `size` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** page size

Returns **any** map of object structure which contains: key is hash
         hash: string, with prefix 0x
         timestamp: milli-seconds from 1970
         from: sender
         to: receiver
         value: transfer amount
         status: 'CONFIRMED' or 'FAILED'
         blockNumber: hex string
         fee: integer

#### sendTransaction

Send transaction

##### Parameters

-   `unsignedTx` **[AionUnsignedTx](#aionunsignedtx)** unsigned transaction build by buildTransaction
-   `signer` **T** localSigner or hardware
-   `signerParams` **any**     localSigner: {private_key} hardware:{derivationIndex}

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[AionPendingTx](#aionpendingtx)>** 

#### getTokenIconUrl

throw not implementated error

##### Parameters

-   `tokenSymbol` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `contractAddress` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

#### buildTransaction

TODO: not general enough.
Build transaction

options parameters contains: gasLimit, gasPrice, isTokenTransfer, data(optional), contractAddr(optional), tokenDecimal(optional).
if isTokenTransfer is true, transaction value is zero and transaction to is token contract creation address,
to parameter is encoded in data.

##### Parameters

-   `from` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** transaction sender
-   `to` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** amount receiver
-   `value` **BigNumber** amount value
-   `options` **{gasLimit: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), gasPrice: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number), isTokenTransfer: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean), data: any?, contractAddr: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)?, tokenDecimal: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?}** extra parameters

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[AionUnsignedTx](#aionunsignedtx)>** 

### AionPendingTx

Aion pending transaction

-   hash: string;
-   status: "PENDING";
-   to: string;
-   from: string;
-   value: BigNumber;
-   tknTo?: string;
-   tknValue?: BigNumber;
-   timestamp: number;
-   gasPrice: number;
-   gasLimit: number;
