# `@makkii/app-btc`

Bitcoin-like(such as Bitcoin, Litecoin, etc) application client:

-   Support Legacy address, prefix with 1
-   Support both mainnet and testnet
-   BIP39 Path m/49'/`coinType`'/0'/0/`index`
      For example, bitcoin's 1st account: m/49'/0'/0'/0/1
-   Support get account from WIF private key

This library uses some services:

-   [bitpay insight-api](https://github.com/bitpay/insight-api/tree/v0.4.3) - pass in [BtcApiClient](#btcapiclient) constructor, used to get balance, broadcast tranaction, etc.
-   Transaction Explorer - [bitpay insight-ui](https://github.com/bitpay/insight)

## Installation

```bash
$ npm install @makkii/app-btc
```

## Usage

```javascript
import {BtcApiClient, BtcKeystoreClient, BtcLocalSigner} from '@makkii/app-btc'

const api_client = new BtcApiClient({ network: 'BTC', insight_api: '***' });
api_client.getBalance('1ADeU4oeRSCTPn8GpZ2g6RXwDKsCuSjSbQ')
    .then(console.log)
    .catch(error=>console.log(error));

const keystore_client = new BtcKeystoreClient('BTC');
api_client.buildTransaction(
    '1ADeU4oeRSCTPn8GpZ2g6RXwDKsCuSjSbQ', // from address
    '147SwRQdpCfj5p8PnfsXV2SsVVpVcz3aPq', // to address
    0, // amount
    {
        byte_fee: 10,
    }
).then(function(unsignedTx) {
    keystore_client.signTransaction(unsignedTx, new BtcLocalSigner(), {
        private_key: '***'
    }).then(function(signedTx) {
        console.log(signedTx);
    });
});
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [BtcLocalSigner](#btclocalsigner)
    -   [signTransaction](#signtransaction)
        -   [Parameters](#parameters)
-   [BtcKeystoreClient](#btckeystoreclient)
    -   [Parameters](#parameters-1)
    -   [ledgerSupport](#ledgersupport)
    -   [getCurrentNetwork](#getcurrentnetwork)
    -   [checkLedgerSupport](#checkledgersupport)
    -   [signTransaction](#signtransaction-1)
        -   [Parameters](#parameters-2)
    -   [generateMnemonic](#generatemnemonic)
    -   [recoverKeyPairByPrivateKey](#recoverkeypairbyprivatekey)
        -   [Parameters](#parameters-3)
    -   [recoverKeyPairByWIF](#recoverkeypairbywif)
        -   [Parameters](#parameters-4)
    -   [validatePrivateKey](#validateprivatekey)
        -   [Parameters](#parameters-5)
    -   [validateAddress](#validateaddress)
        -   [Parameters](#parameters-6)
    -   [getAccountFromMnemonic](#getaccountfrommnemonic)
        -   [Parameters](#parameters-7)
    -   [getAccountFromHardware](#getaccountfromhardware)
        -   [Parameters](#parameters-8)
-   [IBtcConfig](#ibtcconfig)
    -   [network](#network)
    -   [insight_api](#insight_api)
    -   [broadcast](#broadcast)
    -   [explorer](#explorer)
-   [BtcUnsignedTx](#btcunsignedtx)
-   [BtcApiClient](#btcapiclient)
    -   [Parameters](#parameters-9)
    -   [config](#config)
    -   [getNetwork](#getnetwork)
    -   [updateConfiguration](#updateconfiguration)
        -   [Parameters](#parameters-10)
    -   [getBlockByNumber](#getblockbynumber)
        -   [Parameters](#parameters-11)
    -   [getBlockNumber](#getblocknumber)
    -   [getTransactionStatus](#gettransactionstatus)
        -   [Parameters](#parameters-12)
    -   [getTransactionExplorerUrl](#gettransactionexplorerurl)
        -   [Parameters](#parameters-13)
    -   [getBalance](#getbalance)
        -   [Parameters](#parameters-14)
    -   [getTransactionsByAddress](#gettransactionsbyaddress)
        -   [Parameters](#parameters-15)
    -   [sendTransaction](#sendtransaction)
        -   [Parameters](#parameters-16)
    -   [sameAddress](#sameaddress)
        -   [Parameters](#parameters-17)
    -   [sendAll](#sendall)
        -   [Parameters](#parameters-18)
    -   [buildTransaction](#buildtransaction)
        -   [Parameters](#parameters-19)
-   [BtcTxStatus](#btctxstatus)
-   [BtcTransaction](#btctransaction)
-   [BtcPendingTransaction](#btcpendingtransaction)
-   [BtcKeypair](#btckeypair)

### BtcLocalSigner

#### signTransaction

Sign transaction of btc local signer

##### Parameters

-   `transaction` **[BtcUnsignedTx](#btcunsignedtx)** 
-   `params` **{private_key: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), compressed: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean), network: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** {private_key: string, compressed: boolean}

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** btc signed tx

### BtcKeystoreClient

#### Parameters

-   `network` **(`"BTC"` \| `"BTCTEST"` \| `"LTC"` \| `"LTCTEST"`)** 

#### ledgerSupport

only btc btcTest support ledger

#### getCurrentNetwork

Get current network

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** network

#### checkLedgerSupport

Check ledger support

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** if support ledger

#### signTransaction

Sign transaction by signer

##### Parameters

-   `tx` **[BtcUnsignedTx](#btcunsignedtx)** 
-   `signer` **T** localSigner or hardware
-   `signerParam` **any** localSigner: {private_key, compressed} hardware:{derivationIndex}
-   `unsignedTx`  unsigned transaction build by buildTransaction

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** encoded transaction

#### generateMnemonic

Generate mnemonic by bip39

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 12 length of mnemonic

#### recoverKeyPairByPrivateKey

Recover key pair by private key

##### Parameters

-   `priKey` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `options` **any?** **compressed** _boolean_ whether to compress public key

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[BtcKeypair](#btckeypair)>** 

#### recoverKeyPairByWIF

Recover key pair by wif

##### Parameters

-   `WIF` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `wif`  wif string

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[BtcKeypair](#btckeypair)>** 

#### validatePrivateKey

Validate private key

not implemented

##### Parameters

-   `privateKey` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** 

#### validateAddress

Validate address

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### getAccountFromMnemonic

Get account from mnemonic

##### Parameters

-   `address_index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** bip39 path index
-   `mnemonic` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[BtcKeypair](#btckeypair)>** 

#### getAccountFromHardware

Get account from hardware

##### Parameters

-   `index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** derivation index
-   `hardware` **IHardware** 

### IBtcConfig

#### network

Network name

Type: (`"BTC"` \| `"BTCTEST"` \| `"LTC"` \| `"LTCTEST"`)

#### insight_api

bitcoin reset api: <https://github.com/bitpay/insight-api/tree/v0.4.3>

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### broadcast

bitcoin broadcasst tx api

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### explorer

bitcoin explorer url to show tx detail

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

### BtcUnsignedTx

BTC unsigned transaction.

-   to: Array&lt;{ addr: string; value: number }>;
-   from: Array&lt;{ addr: string; value: number }>;
-   value: BigNumber;
-   utxos: Array&lt;{ hash: string; index: number; script: string; raw: string; amount: number; }>;
-   change_address: string;
-   to_address: string;
-   byte_fee: number;
-   network: string;

### BtcApiClient

BTC api client that implement IsingleApiClient

#### Parameters

-   `config` **[IBtcConfig](#ibtcconfig)** 

#### config

Config  of btc api client

Type: [IBtcConfig](#ibtcconfig)

#### getNetwork

Get network of btc api client

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** network

#### updateConfiguration

Update configuration of btc api client

##### Parameters

-   `config` **[IBtcConfig](#ibtcconfig)** 

#### getBlockByNumber

Get block by number

not implemented

##### Parameters

-   `blockNumber` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

#### getBlockNumber

Get current Block height

not implemented

#### getTransactionStatus

Get transaction status by tx id

##### Parameters

-   `hash` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** transaction id

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[BtcTxStatus](#btctxstatus)>** transaction status

#### getTransactionExplorerUrl

Get an explorer url showing transaction details

##### Parameters

-   `hash` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** url

#### getBalance

Get an account's balance

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;BigNumber>** balance

#### getTransactionsByAddress

Get transactions by address

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `page` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 
-   `size` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Map](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), [BtcTransaction](#btctransaction)>>** 

#### sendTransaction

Send transaction

##### Parameters

-   `unsignedTx` **[BtcUnsignedTx](#btcunsignedtx)** unsigned transaction build by buildTransaction
-   `signer` **T** localSigner or hardware
-   `signerParams` **any**     localSigner: {private_key, compressed} hardware:{derivationIndex}

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[BtcPendingTransaction](#btcpendingtransaction)>** 

#### sameAddress

check if two address is same

##### Parameters

-   `address1` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `address2` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 

Returns **[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### sendAll

try to estimate send one address all balance

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `byte_fee` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)>** one address all balance after minus fee

#### buildTransaction

Build transaction

##### Parameters

-   `from` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `to` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** 
-   `value` **BigNumber** 
-   `options` **{byte_fee: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)}** 

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[BtcUnsignedTx](#btcunsignedtx)>** 

### BtcTxStatus

BTC transaction status

-   status: boolean;
-   blockNumber?: number;
-   timestamp?: number;

### BtcTransaction

BTC transaction

-   hash: string;
-   timestamp: number;
-   blockNUmber: number;
-   status: "CONFIRMED";
-   from: Array&lt;{ addr: string; value: number; }>;
-   to: Array&lt;{ addr: string; value: number; }>;
-   fee: number;

### BtcPendingTransaction

BTC pending transaction.

-   hash: string;
-   status: "PENDING";
-   from: Array&lt;{ addr: string; value: number; }>;
-   to: Array&lt;{ addr: string; value: number; }>;
-   fee: number;

### BtcKeypair

BTC key pair.

-   private_key: string;
-   public_key: string;
-   address: string;
-   index?: number;
-   compressed?: boolean;
-   sign?: (hash: any) => Buffer;
-   toWIF?: () => string;
