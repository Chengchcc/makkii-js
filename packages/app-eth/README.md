# `@makkii/app-eth`

Ethereum application client.

This library uses some third-party service:

-   Web3 JsonRPC - you can pass in jsonrpc in [EthApiClient](#ethapiclient) Constructor
-   Explorer Api - To get transaction history, token history, we have two solutions:
    -   `http://api.ethplorer.io`
    -   `http://api.etherscan.io/api`
-   Transaction Explorer - To show transaction detail page:
    -   `https://www.etherchain.org/tx/<txHash>`
    -   `https://api.etherscan.io/tx/<txHash>`
-   Remote Api - we setup our own server to provide token list and icons.

## Installation

```bash
$ npm install @makkii/app-eth
```

## Usage

```javascript
import { EthApiClient, EthKeystoreClient, EthLocalSigner } from '@makkii/app-eth';

const api_client = new EthApiClient({
    network: 'mainnet',
    jsonrpc: '***'
});
api_client.getBalance('0x...')
    .then(console.log)
    .catch(error=>console.log(error));
const keystore_client = new EthKeystoreClient();
api_client.buildTransaction(
    '0x...', // from address
    '0x...', // to address
    0, // amount
    {
        gasPrice: 10,
        gasLimit: 21000,
        isTokenTransfer: false
    }
).then(function(unsignedTx) {
    keystore_client.signTransaction(unsignedTx, new EthLocalSigner(), {
        private_key: '***'
    }).then(function(signedTx) {
        console.log(signedTx);
    });
});
```

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

#### Table of Contents

-   [EthLocalSinger](#ethlocalsinger)
    -   [signTransaction](#signtransaction)
        -   [Parameters](#parameters)
-   [IEthConfig](#iethconfig)
    -   [network](#network)
    -   [jsonrpc](#jsonrpc)
    -   [explorer_api](#explorer_api)
    -   [explorer](#explorer)
    -   [remote_api](#remote_api)
-   [EthKeystoreClient](#ethkeystoreclient)
    -   [validatePrivateKey](#validateprivatekey)
        -   [Parameters](#parameters-1)
    -   [getAccountFromMnemonic](#getaccountfrommnemonic)
        -   [Parameters](#parameters-2)
-   [EthUnsignedTx](#ethunsignedtx)
-   [EthPendingTx](#ethpendingtx)
-   [EthApiClient](#ethapiclient)
    -   [Parameters](#parameters-3)
    -   [getNetwork](#getnetwork)
    -   [getBlockByNumber](#getblockbynumber)
        -   [Parameters](#parameters-4)
    -   [getBlockNumber](#getblocknumber)
    -   [getTransactionStatus](#gettransactionstatus)
        -   [Parameters](#parameters-5)
    -   [getTransactionsByAddress](#gettransactionsbyaddress)
        -   [Parameters](#parameters-6)
    -   [sendTransaction](#sendtransaction)
        -   [Parameters](#parameters-7)
    -   [getTopTokens](#gettoptokens)
        -   [Parameters](#parameters-8)

### EthLocalSinger

Ethereum's signer using private key, implements IkeystoreSigner.

#### signTransaction

Sign transaction

##### Parameters

-   `transaction` **[EthUnsignedTx](#ethunsignedtx)** 
-   `params` **{private_key: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}** parameters object, example: { private_key: '' }}
-   `tx`  EthUnsignedTx transaction object to sign.

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)>** transaction hash string

### IEthConfig

Ethereum configuration interface

#### network

Network name

Type: (`"mainnet"` \| `"ropsten"`)

#### jsonrpc

JsonRPC endpoint

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

#### explorer_api

api endpoint that used to query transaction information

Type: {provider: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), url: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), key: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}

#### explorer

Transaction explorer page

Type: {provider: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String), url: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)}

#### remote_api

app server endpoint that provides token, icons, etc.

Type: [string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)

### EthKeystoreClient

Ethereum keystore client that implements IsingleKeystoreClient

#### validatePrivateKey

throws not implemented error

##### Parameters

-   `privateKey` **([string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Buffer](https://nodejs.org/api/buffer.html))** 

#### getAccountFromMnemonic

Get account from mnemonic

##### Parameters

-   `address_index` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** index in hd wallet
-   `mnemonic` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** mnemonic phrase

Returns **any** account object: { private_key: '', public_key: '', address: '', index: '' }

### EthUnsignedTx

Ethereum unsigned transaction

-   to: string;
-   from: string;
-   nonce: string;
-   value: BigNumber;
-   gasPrice: number;
-   gasLimit: number;
-   data?: any;
-   network: string;

### EthPendingTx

Ethereum pending transaction

-   hash: string;
-   status: "PENDING";
-   to: string;
-   from: string;
-   value: BigNumber;
-   tknTo?: string;
-   tknValue: BigNumber;
-   gasPrice: number;
-   gasLimit: number;

### EthApiClient

Ethereum api client that implements IsingleApiFullClient

#### Parameters

-   `config` **[IEthConfig](#iethconfig)** 

#### getNetwork

Get network name: mainnet, amity.

#### getBlockByNumber

Get block by number, block information doesn't contains transaction details

##### Parameters

-   `blockNumber` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** block number's hex string

Returns **any** eth_getBlockNumber response's result

#### getBlockNumber

Get latest block number

Returns **any** eth_getBlockNumber response's result

#### getTransactionStatus

Get transaction status.

##### Parameters

-   `hash` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** transaction hash

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;any>**     if eth_getTransactionReceipt is null, returns null;
    else return object { status: true/false, blockNumber: intger, gasUsed: integer }

#### getTransactionsByAddress

Get transactions by the given address

##### Parameters

-   `address` **[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)** account address
-   `page` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** page number
-   `size` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)** page size
-   `timestamp` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** earlier than this timestamp

Returns **any** array of object structure which contains:<br>-   **hash**: string, with prefix 0x
-   **timestamp**: milli-seconds from 1970
-   **from**: sender
-   **to**: receiver
-   **value**: transfer amount
-   **status**: 'CONFIRMED' or 'FAILED'
-   **blockNumber**: hex string
-   **fee**: integer

#### sendTransaction

Send transaction

##### Parameters

-   `unsignedTx` **[EthUnsignedTx](#ethunsignedtx)** unsigned transaction build by buildTransaction
-   `signer` **IkeystoreSigner** localSigner or hardware
-   `signerParams` **any**     localSigner: {private_key} hardware:{derivationIndex}

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[EthPendingTx](#ethpendingtx)>** 

#### getTopTokens

Get top tokens

##### Parameters

-   `topN` **[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)?** default 20

Returns **[Promise](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Token>>** 
